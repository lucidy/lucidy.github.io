<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>男孩无衣</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Lucidy">
  
  
  <meta name="description" content="One By One, Don&apos;t Hurry">
<meta property="og:type" content="website">
<meta property="og:title" content="男孩无衣">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="男孩无衣">
<meta property="og:description" content="One By One, Don&apos;t Hurry">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="男孩无衣">
<meta name="twitter:description" content="One By One, Don&apos;t Hurry">
  
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">男孩无衣</a></h1>
    <p><a href="/">You R Missing Me, But I Want To Fuck U</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>

    <div class="content">




  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/12/03/runtime/">
  <time datetime="2015-12-03T11:11:57.000Z">
    2015-12-03
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/12/03/runtime/">runtime</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>####我们先看看这些这些问题, 您能回答吗?</p>
<ol>
<li>method Ivar结构体中包含那些成员变量, 这些变量的作用是什么</li>
<li>如何与运行时系统进行交互</li>
<li>消息转发和动态方法解析分别指什么</li>
<li>runtime有啥作用</li>
</ol>
<hr>
<p>####今天我们来看看runtime:</p>
<p>######1,消息驱动机制</p>
<p>######2.Runtime实现面向对象</p>
<p>######3.消息转发</p>
<p>######4.RUtime项目的应用</p>
<p>######5.面试题</p>
<h2 id="######6-附录">######6.附录</h2><p>######1.消息驱动机制<br>    运行的时候的一些机制, 主要是消息机制.<br>    对于C语言, 函数的调用在编译的时候会决定调用哪个函数, 编译完成之后直接顺序执行, 并无二义性.<br>    OC的函数调用为消息发送, 属于动态调用过程, 在编译饿时候并不能真正的决定调用哪个函数, 之后在真正运行的时候猜回根据函数的名名称找到.</p>
<p>######2.<br>    OC语言不仅需要一个编译器, 同时也有一个运行时系统来执行好的代码,  运行时系统半圆的较色扮演oc语言的操作系统oc基于该系统来工作.</p>
<p>######3.方法的调用:<br>        [object doSomeMethod];<br>    –&gt; objc_mesgSend(id object, @selector(doSomeMEthod));</p>
<p>######4.发送消息 :<br>    objc_msgSend(reciver, selector)<br>    如果消息含有参数则为:<br>    objc_msgSend(reciver, selector, arg1, arg2, agr3 …)</p>
<p>######5.实现类, 属性, 方法,集成,扩展.<br>    实现这些才能说, 这个语言是面向对象的.</p>
<p>######6.那么用c封装的面向对象应该是什么样子的呢?<br>    struct  objc_object 这个结构体是NSObject的父类.<br>    {<br>        private;<br>        isa_t isa;<br>    }</p>
<pre><code>实例变量:
ivar_name
ivaf_type
ivar_offset 
实例变量所占的字节数. 可以通过偏移量取到下一个偏移量.

<span class="variable">SEL</span> 是一个方法名称, 它可以绑定上任何的实现. 这也是我们 swizzle 的基本原理.

// 会给代价一个runtime的所有方法的接口文档.
</code></pre><p>####二:与Runtime系统的交互<br>    和运行时系统的交互<br>    OC程序有三种途径和运行时系统交互:</p>
<p>######1.通过oc源代码</p>
<p>######2.通过 Foundation 框架中类NSObject的方法.</p>
<p>######3.通过直接调用运行时系统的函数. 就是上面的接口文档.</p>
<p>####动态绑定<br>    如何将消息发给应该执行的对象呢?<br>    本章描述了代码的消息表达式如何转换为objc_msgSend函数的调用 如何通过名字来指定一个方法, 以及如何使用objc_msgSend函数.<br>    —-就是方法链表的遍历! 如果遍历不到, 把这个消息传给父类, 一直向上.</p>
<pre><code>该消息函数做了动态绑定所以需要的一切;
<span class="number">1.</span>它首先找到对应的方法实现, 因为不同类对同一方法可能会有不同的实现, 
<span class="number">2.</span>如果在当前类没有找到, 会根据指向父类的指针, 跳到父类中去寻找.
<span class="number">3.</span>如果nsObject也没有, 那么就会抛异常
那么这个过程就叫做动态绑定.

那么你能在这个过程中干什么呢?

resolveinstanceMethod: 和 resolveClassMethod: 来动态的实现给选定的对象方法或者类方法.
</code></pre><p>没有参数就有两个参数 self  和 SEL<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-(BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    void (^resolveMethod)() =^(id objc_self, SEL cmd_p)&#123;</span><br><span class="line">        NSLog(@<span class="string">"所有不能解析(找不到)的类方法回执行这里"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    // 添加方法</span><br><span class="line">    class_addMethod(objc_getClass(<span class="string">"LanouClass"</span>), sel, </span><br><span class="line">                imp_implementationWithBlock(resolveMethod), <span class="string">"v@:"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 类方法的动态解析</span><br><span class="line">+(BOOL)resolveClassMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    void (^resolveMethod)() =^(id objc_self, SEL cmd_p)&#123;</span><br><span class="line">        NSLog(@<span class="string">"所有不能解析(找不到)的类方法回执行这里"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    // 添加方法</span><br><span class="line">    class_addMethod(object_getClass(objc_getClass(<span class="string">"LanouClass"</span>)), sel, </span><br><span class="line">                    imp_implementationWithBlock(resolveMethod), <span class="string">"v@:"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LanouClass  * lc = [[LanouClass alloc] init];</span><br><span class="line"></span><br><span class="line">objc_msgSend([LanouClass class], sel_registerName(<span class="string">"doSome"</span>));</span><br></pre></td></tr></table></figure></p>
<p>###三:消息转发<br>消息转发很像多继承, 本来由自己实现的方法, 让别人去执行.<br>消息转发是将问题分解到更小的对象中, 但是又以一种对消息发送对象来说完全透明的方式将这些对象联系起来.</p>
<p>我们在一个类的.m文件中, 重写下面两个方法:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-(NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    self.lc = [[LanouClass alloc] init];</span><br><span class="line">    </span><br><span class="line">    // 向self.lc中注册aSelector的相关消息, 如果self.lc中没有aSelector的相关信息(没有这个方法), 在self.lc中注册一个这样的方法. 至于self.lc中有没有这个方法, 我们这里没管, 但实际上我们在上面的代码中已经做了动态绑定.</span><br><span class="line">    NSMethodSignature * signature = [self.lc methodSignatureForSelector:aSelector];</span><br><span class="line">    </span><br><span class="line">    // 向 self.lc 注册 aSelector , 名称存在signature中</span><br><span class="line">    </span><br><span class="line">    // 返回这个标识就好了</span><br><span class="line">    <span class="built_in">return</span> signature;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 转发消息</span><br><span class="line">-(void)forwardInvocation:(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    [anInvocation invokeWithTarget:self.lc];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

    
  </div>
  <footer class="end-sep"> 
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>

  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/11/13/hello-world/">
  <time datetime="2015-11-13T15:14:33.000Z">
    2015-11-13
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/11/13/hello-world/">Hello World</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

    
  </div>
  <footer class="end-sep"> 
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>

  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2015 <a href="/">Lucidy</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: '男孩无衣' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>


</body>
</html>